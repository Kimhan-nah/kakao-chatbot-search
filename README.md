# Kakao Bot Builder 시나리오 필터링 스크립트

이 스크립트는 Kakao Bot Builder API에서 시나리오 목록을 가져와서 필터링하고, 여러 환경(DEV, PROD, STG)을 비교할 수 있습니다.

## 설치

```bash
pip install -r requirements.txt
```

또는 Python 3만 설치되어 있다면:

```bash
python3 -m ensurepip --upgrade
pip3 install -r requirements.txt
```

## 환경 설정

### 1. .env 파일 생성

`.env.example` 파일을 참고하여 `.env` 파일을 생성합니다:

```bash
cp .env.example .env
```

### 2. .env 파일 설정

`.env` 파일을 열어서 각 환경의 API URL과 인증 쿠키를 설정합니다:

```env
# DEV 환경 API URL (선택사항 - 설정하지 않으면 기본값 사용)
KAKAO_API_URL_DEV=https://botbuilder-meta.kakao.com/api/v2/bots/{bot-id}/scenarios
# DEV 환경 인증 쿠키
KAKAO_COOKIE_DEV=

# PROD 환경 API URL (선택사항)
KAKAO_API_URL_PROD=https://botbuilder-meta.kakao.com/api/v2/bots/{bot-id}/scenarios
# PROD 환경 인증 쿠키
KAKAO_COOKIE_PROD=

# STG 환경 API URL (선택사항)
KAKAO_API_URL_STG=https://botbuilder-meta.kakao.com/api/v2/bots/{bot-id}/scenarios
# STG 환경 인증 쿠키
KAKAO_COOKIE_STG=
```

**쿠키 값 확인 방법**: 브라우저 개발자 도구 > 네트워크 탭 > API 요청 헤더에서 Cookie 값을 복사하세요.

**참고**: 
- API URL은 선택사항입니다. 설정하지 않으면 기본값이 사용됩니다.
- DEV 환경의 경우 `KAKAO_COOKIE`도 지원합니다 (하위 호환성).

## 사용법

### 기본 실행

```bash
python3 filter_scenarios.py
```

실행하면 인터랙티브 메뉴가 표시됩니다:

```
================================================================================
명령어:
  0 또는 exit - 프로그램 종료
  1 - DEV 환경 전체 시나리오 출력
  2 - PROD 환경 전체 시나리오 출력
  3 - STG 환경 전체 시나리오 출력
  4 - 환경별 시나리오 비교
  5 - 블록 검색 모드 (DEV, PROD, STG 모든 환경)
================================================================================
```

### 명령어 설명

#### 1. DEV 환경 전체 시나리오 출력
DEV 환경의 모든 시나리오와 블록을 출력합니다.

#### 2. PROD 환경 전체 시나리오 출력
PROD 환경의 모든 시나리오와 블록을 출력합니다. (처음 실행 시 자동으로 데이터 로드)

#### 3. STG 환경 전체 시나리오 출력
STG 환경의 모든 시나리오와 블록을 출력합니다. (처음 실행 시 자동으로 데이터 로드)

#### 4. 환경별 시나리오 비교
DEV, PROD, STG 환경의 시나리오를 비교하여 표시합니다. 각 시나리오가 어떤 환경에 존재하는지, 블록 개수는 얼마인지 확인할 수 있습니다.

#### 5. 블록 검색 모드
모든 환경(DEV, PROD, STG)에서 블록 이름으로 검색합니다. 검색 결과는 환경별로 비교하여 표시됩니다.

- 검색 모드 종료: `0` 또는 `exit` 입력

## 기능

- ✅ 3개 환경(DEV, PROD, STG) 지원
- ✅ 환경별 시나리오 및 블록 조회
- ✅ 환경별 시나리오 비교
- ✅ 블록 이름으로 검색 (모든 환경 동시 검색)
- ✅ 인터랙티브 모드
- ✅ .env 파일을 통한 환경 설정
- ✅ Lazy Loading (필요한 환경 데이터만 로드)

## 출력 형식

### 시나리오 출력 예시

```
시나리오 ID: 64bf87a7c78ec619895838de
시나리오 Name: 시작하기
블록 개수: 2
--------------------------------------------------------------------------------
  [1] 블록 ID: 678744f9e713db37fd287f95 | 블록 Name: 도움말
  [2] 블록 ID: 678779d804eccc7cf9d96959 | 블록 Name: 환자카드 앱스킴 요청
================================================================================
```

### 검색 결과 예시

```
[1] 시나리오: 시작하기
    블록 Name: 도움말
--------------------------------------------------------------------------------
    [DEV] 시나리오 ID: xxx | 블록 ID: xxx
    [PROD] 시나리오 ID: xxx | 블록 ID: xxx
    [STG] 없음
================================================================================
```

## 문제 해결

### 인증 실패 오류

쿠키가 만료되었거나 잘못된 경우 다음을 확인하세요:
1. `.env` 파일에 올바른 쿠키 값이 설정되어 있는지 확인
2. 브라우저에서 최신 쿠키 값을 복사하여 업데이트

### 환경 데이터 로드 실패

특정 환경의 데이터를 로드할 수 없는 경우:
1. 해당 환경의 쿠키가 `.env` 파일에 올바르게 설정되어 있는지 확인
2. 네트워크 연결 상태 확인
3. API URL이 올바른지 확인

## 주의사항

- `.env` 파일은 Git에 커밋하지 마세요 (민감한 정보 포함)
- 쿠키는 주기적으로 갱신이 필요할 수 있습니다
- API URL은 선택사항이지만, 변경이 필요한 경우 `.env` 파일에 설정하세요
